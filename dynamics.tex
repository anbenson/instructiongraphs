\documentclass[12pt]{article}

\usepackage{mathpartir}

\title{Instruction Graph Dynamics}
\author{Andrew Benson}
\date{}

\begin{document}
\maketitle

% Frequently used commands
\newcommand{\sort}[1]{\mathtt{#1}}
\newcommand{\syn}[1]{\textbf{#1}}
\newcommand{\nterm}[1]{\mathit{#1}}

% Frequently used syntax
\newcommand{\prog}[2]{\syn{P(}#1,\ #2\syn{)}}
\newcommand{\sing}[1]{\syn{S(}#1\syn{)}}
\newcommand{\cons}[2]{#1\ \syn{::}\ #2}
\newcommand{\ver}[2]{\syn{V(}#1,\ #2\syn{)}}
\newcommand{\doonce}[2]{\syn{do }#1\syn{ then }#2}
\newcommand{\dountil}[3]{\syn{do }#1\syn{ until }#2\syn{ then }#3}
\newcommand{\ifelse}[3]{\syn{if }#1\syn{ then }#2\syn{ else }#3}
\newcommand{\goto}[1]{\syn{goto }#1}
\newcommand{\progend}[0]{\syn{end}}

\newcommand{\cfg}[4]{\syn{(}#1,\ #2,\ #3,\ #4\syn{)}}

% Frequently used judgments
\newcommand{\terminated}[1]{#1\ \mathtt{terminated}}
\newcommand{\stuck}[1]{#1\ \mathtt{stuck}}
\newcommand{\steps}[2]{#1 \longmapsto #2}

\section{Terminated}

We let $\nterm{I}$ be a $bool$ list, representing the input used to satisfy a
Condition $\nterm{cnd}$, and we let $\nterm{O}$ be an $\nterm{a}$ list,
representing the ordered (but reversed) list of actions that are executed.\\

$\terminated{\cfg{\nterm{n}}{\nterm{vs}}{\nterm{I}}{\nterm{O}}}$ means that the
state with vertex represented by $\nterm{n}$ in vertices $\nterm{vs}$ with
remaining input $\nterm{I}$ and current output $\nterm{O}$ is in a finished
state for the program execution context.

\begin{mathpar}
  \inferrule{
    \ver{\nterm{n}}{\progend} \in \nterm{vs}
  }{
    \terminated{\cfg{\nterm{n}}{\nterm{vs}}{\nterm{I}}{\nterm{O}}}
  }
\end{mathpar}

\section{Stuck}

We let $\nterm{I}$ be a $bool$ list, representing the input used to satisfy a
Condition $\nterm{cnd}$, and we let $\nterm{O}$ be an $\nterm{a}$ list,
representing the ordered (but reversed) list of actions that are executed.\\

$\stuck{\cfg{\nterm{n}}{\nterm{vs}}{\nterm{I}}{\nterm{O}}}$ means that the
state with vertex represented by $\nterm{n}$ in vertices $\nterm{vs}$ with
remaining input $\nterm{I}$ and current output $\nterm{O}$ cannot proceed, as it
requires more input to continue.

\begin{mathpar}
  \inferrule{
    \ver{\nterm{n}}{\dountil{\nterm{a}}{\nterm{cnd}}{\nterm{n'}}} \in \nterm{vs}
  }{
    \stuck{\cfg{\nterm{n}}{\nterm{vs}}{\nterm{[\ ]}}{\nterm{O}}}
  }

  \inferrule{
    \ver{\nterm{n}}{\ifelse{\nterm{cnd}}{\nterm{n'}}{\nterm{n''}}} \in \nterm{vs}
  }{
    \stuck{\cfg{\nterm{n}}{\nterm{vs}}{\nterm{[\ ]}}{\nterm{O}}}
  }
\end{mathpar}

\section{Steps}

We let $\nterm{I}$ be a $bool$ list, representing the input used to satisfy a
Condition $\nterm{cnd}$, and we let $\nterm{O}$ be an $\nterm{a}$ list,
representing the ordered (but reversed) list of actions that are executed.\\

$\steps{
  \cfg{\nterm{n}}{\nterm{vs}}{\nterm{I}}{\nterm{O}}
}{
  \cfg{\nterm{n'}}{\nterm{vs}}{\nterm{I'}}{\nterm{O'}}
}$ means that the state with vertex represented by $\nterm{n}$ in vertices
$\nterm{vs}$ with remaining input $\nterm{I}$ and current output $\nterm{O}$
continues to the state with vertex represented by $\nterm{n'}$ in vertices
$\nterm{vs}$ with remaining input $\nterm{I'}$ and current output $\nterm{O'}$.

\begin{mathpar}
  \inferrule{
    \ver{\nterm{n}}{\doonce{\nterm{a}}{\nterm{n'}}} \in \nterm{vs}
  }{
    \steps{
      \cfg{\nterm{n}}{\nterm{vs}}{\nterm{I}}{\nterm{O}}
    }{
      \cfg{\nterm{n'}}{\nterm{vs}}{\nterm{I}}{\cons{\nterm{a}}{\nterm{O}}}
    }
  }

  \inferrule{
    \ver{\nterm{n}}{\dountil{\nterm{a}}{\nterm{cnd}}{\nterm{n'}}} \in \nterm{vs}
  }{
    \steps{
      \cfg{\nterm{n}}{\nterm{vs}}{\cons{\nterm{true}}{\nterm{I}}}{\nterm{O}}
    }{
      \cfg{\nterm{n'}}{\nterm{vs}}{\nterm{I}}{\cons{\nterm{a}}{\nterm{O}}}
    }
  }

  \inferrule{
    \ver{\nterm{n}}{\dountil{\nterm{a}}{\nterm{cnd}}{\nterm{n'}}} \in \nterm{vs}
  }{
    \steps{
      \cfg{\nterm{n}}{\nterm{vs}}{\cons{\nterm{false}}{\nterm{I}}}{\nterm{O}}
    }{
      \cfg{\nterm{n}}{\nterm{vs}}{\nterm{I}}{\cons{\nterm{a}}{\nterm{O}}}
    }
  }

  \inferrule{
    \ver{\nterm{n}}{\ifelse{\nterm{cnd}}{\nterm{n'}}{\nterm{n''}}} \in \nterm{vs}
  }{
    \steps{
      \cfg{\nterm{n}}{\nterm{vs}}{\cons{\nterm{true}}{\nterm{I}}}{\nterm{O}}
    }{
      \cfg{\nterm{n'}}{\nterm{vs}}{\nterm{I}}{\nterm{O}}
    }
  }

  \inferrule{
    \ver{\nterm{n}}{\ifelse{\nterm{cnd}}{\nterm{n'}}{\nterm{n''}}} \in \nterm{vs}
  }{
    \steps{
      \cfg{\nterm{n}}{\nterm{vs}}{\cons{\nterm{false}}{\nterm{I}}}{\nterm{O}}
    }{
      \cfg{\nterm{n''}}{\nterm{vs}}{\nterm{I}}{\nterm{O}}
    }
  }

  \inferrule{
    \ver{\nterm{n}}{\goto{\nterm{n'}}} \in \nterm{vs}
  }{
    \steps{
      \cfg{\nterm{n}}{\nterm{vs}}{\nterm{I}}{\nterm{O}}
    }{
      \cfg{\nterm{n'}}{\nterm{vs}}{\nterm{I}}{\nterm{O}}
    }
  }
\end{mathpar}

\end{document}
